var Ee=Object.defineProperty;var Te=(o,a,l)=>a in o?Ee(o,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[a]=l;var ie=(o,a,l)=>Te(o,typeof a!="symbol"?a+"":a,l);import{t,v as e,w as X,x as _e,y as $e}from"./vendor-7RmfewPG.js";import{u as ce,m as de,a as he,_ as xe,y as ge,P as pe,b as Me,L as Ae,p as Le,n as De}from"./esri-Dqjx5aQh.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function l(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=l(s);fetch(s.href,i)}})();const K=()=>"https://redfive-api-1092564995915.us-central1.run.app",be=t.createContext(void 0),ye=()=>{const o=t.useContext(be);if(o===void 0)throw new Error("useAuth must be used within an AuthProvider");return o},Ie=({children:o})=>{const[a,l]=t.useState(null),[r,s]=t.useState(!0),[i,f]=t.useState(!1);t.useEffect(()=>{if(window.google&&window.google.accounts){console.log("Google Identity Services already loaded"),s(!1);return}if(document.querySelector('script[src="https://accounts.google.com/gsi/client"]')){console.log("Google Identity Services script already exists, waiting for load...");const k=()=>{window.google&&window.google.accounts?(console.log("Google Identity Services loaded successfully"),s(!1)):setTimeout(k,100)};k();return}const M=()=>{window.google&&window.google.accounts?(console.log("Google Identity Services loaded successfully"),s(!1)):(console.log("Waiting for Google Identity Services to load..."),setTimeout(M,100))},S=document.createElement("script");S.src="https://accounts.google.com/gsi/client",S.async=!0,S.defer=!0,S.onload=M,S.onerror=()=>{console.error("Failed to load Google Identity Services script"),s(!1)},document.head.appendChild(S);const v=localStorage.getItem("user"),E=localStorage.getItem("access_token");if(v&&E)try{($=>{try{const A=JSON.parse(atob($.split(".")[1])),D=Date.now()/1e3;return A.exp<D}catch(A){return console.error("Error checking token expiration:",A),!0}})(E)?(console.log("Access token is expired, attempting refresh..."),setTimeout(async()=>{const $=localStorage.getItem("refresh_token");if($){const A=K();try{const D=await fetch(`${A}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({refresh_token:$})});if(D.ok){const u=await D.json();u.access_token&&(localStorage.setItem("access_token",u.access_token),u.refresh_token&&localStorage.setItem("refresh_token",u.refresh_token),console.log("Token refreshed successfully on app startup"),l(JSON.parse(v)))}else localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}catch(D){console.error("Token refresh failed on startup:",D),localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}}else localStorage.removeItem("user"),localStorage.removeItem("access_token")},100)):l(JSON.parse(v))}catch(k){console.error("Error parsing saved user:",k),localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}return()=>{const k=document.querySelector('script[src="https://accounts.google.com/gsi/client"]');k&&k.remove()}},[]);const x={user:a,isAuthenticated:!!a,isLoading:r,login:()=>{if(console.log("Login button clicked"),i){console.log("Login already in progress, ignoring duplicate request");return}if(!window.google||!window.google.accounts){console.error("Google Identity Services not loaded");return}const j="1092564995915-914iml3sjt13lcb6c038cniqe72374h9.apps.googleusercontent.com";console.log("Client ID:",j),f(!0),console.log("Initializing Google OAuth client..."),window.google.accounts.oauth2.initTokenClient({client_id:j,scope:"openid profile email",ux_mode:"redirect",redirect_uri:window.location.origin,callback:S=>{console.log("OAuth callback received:",S),S.access_token?(console.log("Access token received, authenticating with server..."),fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${S.access_token}`).then(v=>v.json()).then(v=>{console.log("User info received:",v);const E=K();return fetch(`${E}/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({access_token:S.access_token,user_info:v})}).then(k=>k.json()).then(k=>{if(console.log("Server authentication response:",k),k.success||k.user){const $={id:k.user?.id||v.id,name:k.user?.name||v.name,email:k.user?.email||v.email,picture:k.user?.picture||v.picture};l($),localStorage.setItem("user",JSON.stringify($))}else console.error("Server authentication failed:",k);f(!1)})}).catch(v=>{console.error("Error during authentication:",v),f(!1)})):(console.error("No access token in response:",S),f(!1))}}).requestAccessToken()},logout:()=>{const j=K();fetch(`${j}/auth/logout`,{method:"POST",credentials:"include"}).catch(M=>{console.error("Error during logout:",M)}),l(null),f(!1),localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.google&&window.google.accounts&&window.google.accounts.oauth2.revoke()},refreshToken:async()=>{try{const j=localStorage.getItem("refresh_token");if(!j)return console.log("No refresh token available"),!1;const M=K(),S=await fetch(`${M}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({refresh_token:j})});if(!S.ok)return console.error("Token refresh failed:",S.status),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),l(null),!1;const v=await S.json();return v.access_token?(localStorage.setItem("access_token",v.access_token),v.refresh_token&&localStorage.setItem("refresh_token",v.refresh_token),console.log("Token refreshed successfully"),!0):!1}catch(j){return console.error("Token refresh error:",j),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),l(null),!1}}};return e.jsx(be.Provider,{value:x,children:o})},Pe=({children:o})=>{const{isAuthenticated:a,isLoading:l}=ye(),r=t.useRef(null),s=t.useRef(!1),[i,f]=t.useState(!1);return t.useEffect(()=>{if(!s.current&&!l&&!a&&window.google&&window.google.accounts&&r.current){const h="1092564995915-914iml3sjt13lcb6c038cniqe72374h9.apps.googleusercontent.com";s.current=!0,r.current&&(r.current.innerHTML=""),window.google.accounts.id.initialize({client_id:h,callback:d=>{if(console.log("Google Sign-In response:",d),d.credential){f(!0);const g=JSON.parse(atob(d.credential.split(".")[1]));console.log("User info from JWT:",g);const x=K();fetch(`${x}/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:d.credential})}).then(j=>(console.log("Response status:",j.status),j.ok?j.json():j.json().then(M=>{throw console.error("Server error details:",M),new Error(`Server error: ${JSON.stringify(M)}`)}))).then(j=>{if(console.log("Server authentication response:",j),j.access_token){localStorage.setItem("access_token",j.access_token),localStorage.setItem("refresh_token",j.refresh_token);const M={id:g.sub,name:g.name,email:g.email,picture:g.picture};localStorage.setItem("user",JSON.stringify(M)),console.log("Authentication successful! Stored tokens and user data."),console.log("User data:",M),console.log("Access token:",j.access_token),setTimeout(()=>{window.location.reload()},1e3)}}).catch(j=>{console.error("Authentication error:",j),f(!1)})}}}),window.google.accounts.id.renderButton(r.current,{theme:"outline",size:"large",text:"signin_with",shape:"rectangular"})}},[l,a]),t.useEffect(()=>()=>{s.current=!1},[]),l?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh",backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h1",{className:"display-4 fw-bold",style:{color:"#aa0000"},children:[e.jsx("span",{children:"red"}),e.jsx("span",{style:{fontStyle:"italic",opacity:.9},children:"five"})]}),e.jsx("p",{className:"lead text-muted",children:"Data Analytics Workbench"})]}),e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",style:{width:"3rem",height:"3rem"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("h4",{children:"Initializing..."}),e.jsx("p",{className:"text-muted",children:"Setting up authentication"})]})}):i?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh",backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h1",{className:"display-4 fw-bold",style:{color:"#aa0000"},children:[e.jsx("span",{children:"red"}),e.jsx("span",{style:{fontStyle:"italic",opacity:.9},children:"five"})]}),e.jsx("p",{className:"lead text-muted",children:"Data Analytics Workbench"})]}),e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",style:{width:"3rem",height:"3rem"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("h4",{children:"Authenticating..."}),e.jsx("p",{className:"text-muted",children:"Please wait while we verify your identity"})]})}):a?e.jsx(e.Fragment,{children:o}):e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh",backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h1",{className:"display-4 fw-bold",style:{color:"#aa0000"},children:[e.jsx("span",{children:"red"}),e.jsx("span",{style:{fontStyle:"italic",opacity:.9},children:"five"})]}),e.jsx("p",{className:"lead text-muted",children:"Data Analytics Workbench"})]}),e.jsx("div",{className:"card shadow-lg border-0",style:{maxWidth:"400px",margin:"0 auto"},children:e.jsxs("div",{className:"card-body p-5",children:[e.jsx("h4",{className:"card-title text-center mb-4",children:"Welcome"}),e.jsx("p",{className:"text-muted text-center mb-4",children:"Sign in with your Google account to continue"}),e.jsx("div",{ref:r,className:"d-flex justify-content-center"})]})}),e.jsx("div",{className:"mt-4",children:e.jsx("small",{className:"text-muted",children:"Secure authentication powered by Google"})})]})})},ze=()=>{const{user:o,isAuthenticated:a,isLoading:l,login:r,logout:s}=ye(),i=()=>{r()},f=()=>{s()};return e.jsx("nav",{className:"navbar navbar-expand-lg navbar-dark",style:{flexShrink:0,padding:"0px",backgroundColor:"#495057"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs("a",{className:"navbar-brand fw-bold",href:"#",style:{color:"#aa0000",fontSize:"21pt",lineHeight:"1",padding:"0",margin:"0",textShadow:"1px 1px 2px rgba(255, 255, 255, 0.3)"},children:[e.jsx("span",{children:"red"}),e.jsx("span",{style:{fontStyle:"italic",opacity:.9},children:"five"})]}),e.jsx("div",{className:"navbar-nav ms-auto",children:l?e.jsxs("div",{className:"nav-link",children:[e.jsx("i",{className:"bi bi-hourglass-split me-1"}),"Loading..."]}):a&&o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"nav-link d-flex align-items-center",children:[o.picture&&e.jsx("img",{src:o.picture,alt:o.name,className:"rounded-circle me-2",style:{width:"24px",height:"24px"}}),e.jsx("span",{className:"me-3",children:o.name})]}),e.jsxs("a",{className:"nav-link",href:"#",children:[e.jsx("i",{className:"bi bi-gear me-1"}),"Settings"]}),e.jsxs("button",{className:"nav-link btn btn-link text-light text-decoration-none",onClick:f,style:{border:"none",background:"none"},children:[e.jsx("i",{className:"bi bi-box-arrow-right me-1"}),"Logout"]})]}):e.jsxs("button",{className:"nav-link btn btn-link text-light text-decoration-none",onClick:i,style:{border:"none",background:"none"},children:[e.jsx("i",{className:"bi bi-google me-1"}),"Login with Google"]})})]})})};class ue{constructor(a,l){ie(this,"baseUrl");ie(this,"apiKey");this.baseUrl=a||K(),this.apiKey=l}async sendPrompt(a){try{const l={query:a},r={"Content-Type":"application/json",Accept:"application/json"},s=await this.getValidToken();s?r.Authorization=`Bearer ${s}`:this.apiKey&&(r.Authorization=`Bearer ${this.apiKey}`),console.log("Sending request to:",`${this.baseUrl}/generate-sql`),console.log("Request body:",l);const i=await fetch(`${this.baseUrl}/generate-sql`,{method:"POST",headers:r,body:JSON.stringify(l),mode:"cors",credentials:"include",cache:"no-cache"});if(console.log("Response status:",i.status),console.log("Response headers:",i.headers),!i.ok){const h=await i.text();throw console.error("Response error:",h),new Error(`HTTP error! status: ${i.status} - ${h}`)}const f=await i.json();return console.log("Response data:",f),{success:!0,data:f,message:"Request processed successfully"}}catch(l){console.error("DataService error:",l);let r="Unknown error occurred";return l instanceof TypeError&&l.message.includes("Failed to fetch")?r=`Network error: Unable to connect to the data service. Please check if the service is running at ${this.baseUrl}`:l instanceof Error&&(r=l.message),{success:!1,error:r,message:"Failed to process request"}}}async executeSql(a){try{const l={sql:a},r={"Content-Type":"application/json",Accept:"application/json"},s=await this.getValidToken();s?r.Authorization=`Bearer ${s}`:this.apiKey&&(r.Authorization=`Bearer ${this.apiKey}`),console.log("Executing SQL:",a),console.log("Sending request to:",`${this.baseUrl}/execute-sql`);const i=await fetch(`${this.baseUrl}/execute-sql`,{method:"POST",headers:r,body:JSON.stringify(l),mode:"cors",credentials:"include",cache:"no-cache"});if(console.log("Response status:",i.status),!i.ok){const h=await i.text();throw console.error("Response error:",h),new Error(`HTTP error! status: ${i.status} - ${h}`)}const f=await i.json();return console.log("SQL execution response:",f),{success:!0,data:f,message:"SQL executed successfully"}}catch(l){console.error("SQL execution error:",l);let r="Unknown error occurred";return l instanceof TypeError&&l.message.includes("Failed to fetch")?r="Network error: Unable to connect to the data service":l instanceof Error&&(r=l.message),{success:!1,error:r,message:"Failed to execute SQL"}}}async getHealth(){try{const a=await fetch(`${this.baseUrl}/health`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return{success:!0,data:await a.json(),message:"Service is healthy"}}catch(a){return console.error("Health check error:",a),{success:!1,error:a instanceof Error?a.message:"Health check failed",message:"Service is unavailable"}}}setBaseUrl(a){this.baseUrl=a}setApiKey(a){this.apiKey=a}async getModels(){try{const a={"Content-Type":"application/json",Accept:"application/json"},l=await this.getValidToken();l?a.Authorization=`Bearer ${l}`:this.apiKey&&(a.Authorization=`Bearer ${this.apiKey}`),console.log("Getting models from:",`${this.baseUrl}/get-models`);const r=await fetch(`${this.baseUrl}/get-models`,{method:"GET",headers:a,mode:"cors",credentials:"include",cache:"no-cache"});if(console.log("Get models response status:",r.status),!r.ok){const i=await r.text();throw console.error("Get models error:",i),new Error(`HTTP error! status: ${r.status} - ${i}`)}const s=await r.json();return console.log("Get models response data:",s),{success:!0,data:s,message:"Models retrieved successfully"}}catch(a){console.error("Get models error:",a);let l="Unknown error occurred";return a instanceof TypeError&&a.message.includes("Failed to fetch")?l="Network error: Unable to connect to the data service":a instanceof Error&&(l=a.message),{success:!1,error:l,message:"Failed to get models"}}}async refreshToken(){try{const a=localStorage.getItem("refresh_token");if(!a)return{success:!1,error:"No refresh token available",message:"Please log in again"};const l={"Content-Type":"application/json",Accept:"application/json"};console.log("Refreshing token...");const r=await fetch(`${this.baseUrl}/auth/refresh`,{method:"POST",headers:l,body:JSON.stringify({refresh_token:a}),mode:"cors",credentials:"include",cache:"no-cache"});if(console.log("Token refresh response status:",r.status),!r.ok){const i=await r.text();return console.error("Token refresh error:",i),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),{success:!1,error:`Token refresh failed: ${i}`,message:"Please log in again"}}const s=await r.json();return console.log("Token refresh response data:",s),s.access_token&&(localStorage.setItem("access_token",s.access_token),s.refresh_token&&localStorage.setItem("refresh_token",s.refresh_token),console.log("Tokens refreshed successfully")),{success:!0,data:s,message:"Token refreshed successfully"}}catch(a){return console.error("Token refresh error:",a),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),{success:!1,error:a instanceof Error?a.message:"Unknown error occurred",message:"Token refresh failed, please log in again"}}}isTokenExpired(a){try{const l=JSON.parse(atob(a.split(".")[1])),r=Date.now()/1e3;return l.exp<r}catch(l){return console.error("Error checking token expiration:",l),!0}}async getValidToken(){const a=localStorage.getItem("access_token");if(!a)return console.log("No access token found"),null;if(this.isTokenExpired(a)){console.log("Access token is expired, attempting refresh...");const l=await this.refreshToken();return l.success&&l.data?.access_token?l.data.access_token:(console.log("Token refresh failed, user needs to re-authenticate"),null)}return a}}const Oe=({className:o="",onTableSelect:a,onColumnSelect:l,onSchemaSelect:r,onModelsLoaded:s,onGenerateSelect:i,onSpatialColumnsLoaded:f})=>{const[h,d]=t.useState({databases:!0,production:!0,"saved-queries":!1}),[g,x]=t.useState([]),[j,M]=t.useState(!1),[S,v]=t.useState({show:!1,x:0,y:0,type:"table",item:null}),E=new ue,k=n=>{d(m=>({...m,[n]:!m[n]}))},$=n=>{const m={};let p=[];if(Array.isArray(n))p=n;else if(n&&Array.isArray(n.data))p=n.data;else if(n&&n.models&&Array.isArray(n.models))p=n.models;else return console.warn("Models data is not in expected format:",n),m;return p.forEach(N=>{const w=N.schema||N.schema_name||N.database_schema||"default",T=N.name||N.table_name;m[w]||(m[w]={}),m[w][T]||(m[w][T]=[]),N.columns&&(m[w][T]=N.columns)}),Object.keys(m).forEach(N=>{Object.keys(m[N]).forEach(w=>{m[N][w].sort((T,F)=>T.name.localeCompare(F.name))})}),m},A=n=>{const m=[];return n.forEach(p=>{p.columns&&Array.isArray(p.columns)&&p.columns.forEach(N=>{N.spatial_type&&N.spatial_type!==null&&N.spatial_type!==""&&m.push(N.name)})}),m},D=t.useMemo(()=>g.length===0?{}:$(g),[g]),u=async()=>{console.log("Starting to load models..."),M(!0);try{const n=await E.getModels();if(console.log("Models response:",n),n.success&&n.data){console.log("Models response data:",n.data),console.log("Models data type:",typeof n.data),console.log("Is array:",Array.isArray(n.data)),console.log("Models length:",n.data?.length);let m=[];if(Array.isArray(n.data))m=n.data;else if(n.data.models&&Array.isArray(n.data.models))m=n.data.models;else{console.warn("Could not find models array in response:",n.data),x([]);return}console.log("Extracted models array:",m),x(m);const p=A(m);console.log("Extracted spatial columns:",p),s&&s(m),f&&f(p);const N=$(m),w={databases:!0,production:!0,"saved-queries":!1};Object.keys(N).forEach(T=>{w[`schema-${T}`]=!0}),d(w)}else console.error("Failed to load models:",n.error),x([])}catch(n){console.error("Failed to load models:",n),x([])}finally{M(!1)}};t.useEffect(()=>{u()},[]),t.useEffect(()=>{g.length>0&&s&&s(g)},[g,s]);const C=(n,m,p)=>{n.preventDefault(),n.stopPropagation(),console.log("Context menu triggered for:",m,p),v({show:!0,x:n.clientX,y:n.clientY,type:m,item:p})},y=()=>{v({show:!1,x:0,y:0,type:"table",item:null})};return t.useEffect(()=>{const n=()=>{S.show&&y()};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[S.show]),e.jsxs("div",{className:`bg-light border-end d-flex flex-column h-100 ${o}`,style:{overflow:"hidden"},children:[e.jsx("div",{className:"p-2 border-bottom panel-header",style:{background:"linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%)"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"text-muted mb-0 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-folder me-2"}),"Model Explorer"]}),e.jsx("div",{className:"d-flex gap-1",children:e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:u,disabled:j,title:"Reload models",children:j?e.jsx("i",{className:"bi bi-hourglass-split"}):e.jsx("i",{className:"bi bi-arrow-clockwise"})})})]})}),e.jsx("div",{className:"flex-grow-1",style:{height:"0",minHeight:"0",overflowY:"auto",overflowX:"hidden"},onContextMenu:n=>{n.preventDefault(),n.stopPropagation()},children:j?e.jsxs("div",{className:"p-3 text-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm text-muted",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"small text-muted mt-2",children:"Loading models..."})]}):g.length>0?e.jsxs(e.Fragment,{children:[Object.entries(D).sort(([n],[m])=>n.localeCompare(m)).map(([n,m])=>e.jsxs("div",{className:"explorer-item",children:[e.jsxs("div",{className:"explorer-folder",onClick:p=>{k(`schema-${n}`),p.target instanceof HTMLElement&&(p.target.tagName==="SPAN"||p.target.closest("span"))&&r&&(console.log("ModelExplorer: Schema selected:",n),r(n))},style:{cursor:"pointer"},children:[e.jsx("i",{className:`bi ${h[`schema-${n}`]?"bi-chevron-down":"bi-chevron-right"} me-1`}),e.jsx("i",{className:"bi bi-folder me-2"}),e.jsx("span",{children:n})]}),h[`schema-${n}`]&&e.jsx("div",{className:"explorer-children",children:Object.entries(m).sort(([p],[N])=>p.localeCompare(N)).map(([p,N])=>{const w=Array.isArray(g)?g.find(T=>T.name===p):null;return e.jsxs("div",{className:"explorer-item",children:[e.jsxs("div",{className:"explorer-folder",onClick:()=>{k(`table-${n}-${p}`),a&&w&&a(w)},onContextMenu:T=>{T.preventDefault(),T.stopPropagation(),C(T,"table",w||{name:p,schema:n})},style:{cursor:"pointer"},children:[e.jsx("i",{className:`bi ${h[`table-${n}-${p}`]?"bi-chevron-down":"bi-chevron-right"} me-1`}),e.jsx("i",{className:"bi bi-table me-2"}),e.jsx("span",{children:p})]}),h[`table-${n}-${p}`]&&e.jsx("div",{className:"explorer-children",children:N.map(T=>e.jsxs("div",{className:"explorer-file",onClick:()=>{l&&l(T.name)},onContextMenu:F=>{F.preventDefault(),F.stopPropagation(),C(F,"column",T)},style:{cursor:"pointer"},children:[e.jsx("i",{className:"bi bi-columns me-2"}),e.jsxs("span",{children:[T.name,T.spatial_type==="point"?e.jsx("span",{style:{color:"#aa0000"},children:"*"}):T.spatial_type==="polyline"?e.jsx("span",{style:{color:"#aa0000"},children:"**"}):T.spatial_type==="polygon"?e.jsx("span",{style:{color:"#aa0000"},children:"***"}):""]}),e.jsxs("span",{className:"text-muted small ms-2",children:["(",T.type,")"]})]},T.name))})]},p)})})]},n)),e.jsxs("div",{className:"explorer-item",children:[e.jsxs("div",{className:"explorer-folder",onClick:()=>k("saved-queries"),children:[e.jsx("i",{className:`bi ${h["saved-queries"]?"bi-chevron-down":"bi-chevron-right"} me-1`}),e.jsx("i",{className:"bi bi-folder me-2"}),e.jsx("span",{children:"Saved Queries"})]}),h["saved-queries"]&&e.jsxs("div",{className:"explorer-children",children:[e.jsxs("div",{className:"explorer-file",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),e.jsx("span",{children:"user_analysis.sql"})]}),e.jsxs("div",{className:"explorer-file",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),e.jsx("span",{children:"sales_report.sql"})]}),e.jsxs("div",{className:"explorer-file",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),e.jsx("span",{children:"inventory_check.sql"})]})]})]})]}):e.jsxs("div",{className:"p-3 text-center text-muted",children:[e.jsx("i",{className:"bi bi-database fs-1 mb-2"}),e.jsx("div",{children:"No models loaded"}),e.jsx("small",{children:"Models will appear here once loaded"})]})}),S.show&&e.jsx("div",{className:"context-menu",style:{position:"fixed",top:S.y,left:S.x,zIndex:9999,backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"4px 0",minWidth:"180px",fontSize:"14px"},onClick:n=>n.stopPropagation(),children:S.type==="table"&&i&&e.jsxs("div",{className:"context-menu-item",onClick:()=>{i(S.item),v({show:!1,x:0,y:0,type:"table",item:null})},style:{padding:"10px 16px",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"10px",borderBottom:"1px solid #f0f0f0",transition:"background-color 0.2s"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="#f8f9fa"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("i",{className:"bi bi-code-slash text-success"}),e.jsx("span",{children:"Generate Select"})]})})]})},Fe=t.memo(Oe),We=({selectedTable:o,selectedColumn:a,className:l=""})=>o?e.jsxs("div",{className:`p-3 ${l}`,style:{overflow:"auto",maxHeight:"100%"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:"bi bi-table me-2",style:{color:"#aa0000"}}),e.jsx("h4",{className:"mb-0",style:{color:"#aa0000"},children:o.label||o.name})]}),e.jsxs("div",{className:"text-muted small",children:[e.jsx("span",{className:"badge me-2",style:{backgroundColor:"#aa0000",color:"white"},children:o.schema}),e.jsx("span",{className:"badge",style:{backgroundColor:"#f8f9fa",color:"#aa0000",border:"1px solid #aa0000",padding:"0.25em 0.4em",fontSize:"0.75em",fontWeight:"700"},children:o.name})]}),o.description&&e.jsx("p",{className:"mt-2",style:{color:"#666"},children:o.description})]}),o.keys?.primary&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{style:{color:"#aa0000"},children:[e.jsx("i",{className:"bi bi-key me-1",style:{color:"#aa0000"}}),"Primary Key"]}),e.jsx("div",{className:"p-2 rounded",style:{backgroundColor:"#fff5f5",border:"1px solid #ffcccc"},children:e.jsx("code",{style:{color:"#aa0000"},children:o.keys.primary})})]}),o.keys?.foreign&&o.keys.foreign.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{style:{color:"#aa0000"},children:[e.jsx("i",{className:"bi bi-link-45deg me-1",style:{color:"#aa0000"}}),"Foreign Keys"]}),o.keys.foreign.map((r,s)=>e.jsxs("div",{className:"p-2 rounded mb-2",style:{backgroundColor:"#fff5f5",border:"1px solid #ffcccc"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#aa0000"},children:"Columns:"})," ",e.jsx("code",{style:{color:"#aa0000"},children:r.columns})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#aa0000"},children:"References:"})," ",e.jsxs("code",{style:{color:"#aa0000"},children:[r.ref_schema,".",r.ref_table,"(",r.ref_columns,")"]})]})]},s))]}),e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-3",style:{color:"#aa0000"},children:[e.jsx("i",{className:"bi bi-columns me-1",style:{color:"#aa0000"}}),"Columns (",o.columns.length,")"]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-hover",children:[e.jsx("thead",{style:{backgroundColor:"#fff5f5"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Name"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Type"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Semantic Role"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Nullable"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Description"})]})}),e.jsx("tbody",{children:o.columns.map(r=>e.jsxs("tr",{className:a===r.name?"table-warning":"",style:a===r.name?{backgroundColor:"#fff5f5"}:{},children:[e.jsxs("td",{children:[e.jsx("code",{className:a===r.name?"fw-bold":"",style:{color:"#aa0000"},children:r.name}),r.label&&r.label!==r.name&&e.jsx("div",{className:"small",style:{color:"#666"},children:r.label})]}),e.jsx("td",{style:{verticalAlign:"middle"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"badge",style:{backgroundColor:"#aa0000",color:"white"},children:r.type}),r.spatial_type&&r.spatial_type!==null&&r.spatial_type!==""&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"transparent",color:"#aa0000",border:"1px solid #aa0000"},children:r.spatial_type})]})}),e.jsx("td",{style:{verticalAlign:"middle"},children:r.semantic_role&&r.semantic_role!==null&&r.semantic_role!==""?e.jsx("span",{className:"badge",style:{backgroundColor:"#f8f9fa",color:"#aa0000",border:"1px solid #aa0000"},children:r.semantic_role}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:r.nullable?e.jsx("span",{style:{color:"#666"},children:"Yes"}):e.jsx("span",{className:"fw-bold",style:{color:"#aa0000"},children:"No"})}),e.jsx("td",{className:"small",style:{color:"#666"},children:r.description||"-"})]},r.name))})]})})]})]}):e.jsxs("div",{className:`p-4 text-center text-muted ${l}`,children:[e.jsx("i",{className:"bi bi-info-circle fs-1 mb-3"}),e.jsx("h5",{children:"No Table Selected"}),e.jsx("p",{children:"Select a table from the explorer to view its details"})]}),Ge=({schemaName:o,models:a,className:l=""})=>{const[r,s]=t.useState(""),i=t.useMemo(()=>{const h=[];return a.forEach(d=>{const g=d.schema||d.schema_name||d.database_schema||"default";g===o&&d.columns&&d.columns.forEach(x=>{h.push({name:x.name,table:d.name,type:x.type||"N/A",nullable:x.nullable||!1,description:x.description,schema:g,spatial_type:x.spatial_type,semantic_role:x.semantic_role})})}),h.sort((d,g)=>d.name!==g.name?d.name.localeCompare(g.name):d.table.localeCompare(g.table))},[a,o]),f=t.useMemo(()=>{if(!r.trim())return i;const h=r.toLowerCase();return i.filter(d=>d.name.toLowerCase().includes(h)||d.table.toLowerCase().includes(h)||d.type.toLowerCase().includes(h)||d.description&&d.description.toLowerCase().includes(h))},[i,r]);return i.length===0?e.jsxs("div",{className:`p-4 text-center text-muted ${l}`,children:[e.jsx("i",{className:"bi bi-database fs-1 mb-3",style:{color:"#aa0000"}}),e.jsx("h5",{style:{color:"#aa0000"},children:"No Columns Found"}),e.jsxs("p",{children:['No columns available for schema "',o,'"']})]}):e.jsxs("div",{className:`p-3 ${l}`,style:{overflow:"auto",maxHeight:"100%"},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:"bi bi-database me-2",style:{color:"#aa0000"}}),e.jsxs("h4",{className:"mb-0",style:{color:"#aa0000"},children:["Schema: ",o]})]}),e.jsx("div",{className:"text-muted small",children:e.jsxs("span",{className:"badge me-2",style:{backgroundColor:"#aa0000",color:"white"},children:[i.length," columns across ",new Set(i.map(h=>h.table)).size," tables"]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",style:{backgroundColor:"#fff5f5",borderColor:"#aa0000"},children:e.jsx("i",{className:"bi bi-search",style:{color:"#aa0000"}})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Filter columns by name, table, type, or description...",value:r,onChange:h=>s(h.target.value),style:{borderColor:"#aa0000"}})]}),r&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-muted",children:["Showing ",f.length," of ",i.length," columns"]})})]}),e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-3",style:{color:"#aa0000"},children:[e.jsx("i",{className:"bi bi-table me-1",style:{color:"#aa0000"}}),"All Columns (",f.length,")"]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-hover",children:[e.jsx("thead",{style:{backgroundColor:"#fff5f5"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Column"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Table"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Type"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Semantic Role"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Nullable"}),e.jsx("th",{style:{color:"#aa0000",borderBottom:"2px solid #aa0000"},children:"Description"})]})}),e.jsx("tbody",{children:f.map((h,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{style:{color:"#aa0000"},children:h.name})}),e.jsx("td",{style:{verticalAlign:"middle"},children:e.jsx("span",{className:"badge",style:{backgroundColor:"#f8f9fa",color:"#aa0000",border:"1px solid #aa0000",padding:"0.25em 0.4em",fontSize:"0.75em",fontWeight:"700"},children:h.table})}),e.jsx("td",{style:{verticalAlign:"middle"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"badge",style:{backgroundColor:"#aa0000",color:"white"},children:h.type}),h.spatial_type&&h.spatial_type!==null&&h.spatial_type!==""&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"transparent",color:"#aa0000",border:"1px solid #aa0000"},children:h.spatial_type})]})}),e.jsx("td",{style:{verticalAlign:"middle"},children:h.semantic_role&&h.semantic_role!==null&&h.semantic_role!==""?e.jsx("span",{className:"badge",style:{backgroundColor:"#f8f9fa",color:"#aa0000",border:"1px solid #aa0000"},children:h.semantic_role}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:h.nullable?e.jsx("span",{style:{color:"#666"},children:"Yes"}):e.jsx("span",{className:"fw-bold",style:{color:"#aa0000"},children:"No"})}),e.jsx("td",{className:"small",style:{color:"#666"},children:h.description||"-"})]},`${h.table}-${h.name}-${d}`))})]})})]})]})},Ue=({queryText:o,onQueryChange:a,onExecute:l,onSave:r,onFormat:s,selectedTable:i,selectedColumn:f,selectedSchema:h,models:d=[],className:g=""})=>{const[x,j]=t.useState([{id:"docs",name:"ðŸ“‹ Models",content:"",isDirty:!1},{id:"1",name:"Query 1",content:"",isDirty:!1}]),M=X.useRef(0),[S,v]=t.useState("1"),[E,k]=t.useState(2);t.useEffect(()=>{j(c=>c.map(b=>b.id===S?{...b,content:o,isDirty:!0}:b)),o&&o.length>M.current&&o.length-M.current>10&&setTimeout(()=>{const c=document.querySelector(".query-editor-textarea");c&&(c.scrollTop=c.scrollHeight)},100),M.current=o.length},[o]);const[$,A]=t.useState(null),[D,u]=t.useState(""),[C,y]=t.useState(0),[n,m]=t.useState(!1),[p,N]=t.useState(!1),[w,T]=t.useState({show:!1,x:0,y:0,tabId:""}),F=x.find(c=>c.id===S),z=()=>{const c={id:E.toString(),name:`Query ${E}`,content:"",isDirty:!1};j(b=>[...b,c]),v(c.id),k(b=>b+1)},W=c=>{if(c==="docs")return;if(x.length<=2){const _={id:E.toString(),name:`Query ${E}`,content:"",isDirty:!1};j(O=>[...O.filter(H=>H.id==="docs"),_]),v(_.id),k(O=>O+1),a("");return}const b=x.filter(_=>_.id!==c);if(j(b),S===c){const _=x.findIndex(H=>H.id===c),O=_>0?_-1:0;v(b[O].id)}},U=c=>{v(c);const b=x.find(_=>_.id===c);b&&a(b.content)},L=c=>{j(b=>b.map(_=>_.id===S?{..._,content:c,isDirty:c!==""}:_)),a(c)},Z=()=>{const c=document.querySelector(".query-editor-textarea");if(c){const b=c.selectionStart,_=c.selectionEnd;if(b!==_)return c.value.substring(b,_).trim()}return null},q=t.useCallback(()=>{const c=Z();c?l(c):l()},[l]),J=c=>{const b=x.find(_=>_.id===c);b&&(A(c),u(b.name))},R=()=>{$&&D.trim()&&j(c=>c.map(b=>b.id===$?{...b,name:D.trim()}:b)),A(null),u("")},ee=()=>{A(null),u("")},se=c=>{c.key==="Enter"?R():c.key==="Escape"&&ee()},Y=()=>{const c=document.querySelector(".tab-scroll-container");if(c){const b=Math.max(0,C-200);c.scrollLeft=b,y(b)}},Q=()=>{const c=document.querySelector(".tab-scroll-container");if(c){const b=c.scrollWidth-c.clientWidth,_=Math.min(b,C+200);c.scrollLeft=_,y(_)}},te=()=>{const c=document.querySelector(".tab-scroll-container");if(c){const b=c.scrollWidth-c.clientWidth;m(C>0),N(C<b)}};X.useEffect(()=>{te()},[x,C]);const ae=(c,b)=>{c.preventDefault(),T({show:!0,x:c.clientX,y:c.clientY,tabId:b})},B=()=>{T({show:!1,x:0,y:0,tabId:""})},re=c=>{const b=x.find(_=>_.id===c);if(b){const _={id:E.toString(),name:`${b.name} (Copy)`,content:b.content,isDirty:!1};j(O=>[...O,_]),v(_.id),k(O=>O+1)}B()},ne=()=>{const c=x.find(_=>_.id==="docs"),b={id:E.toString(),name:`Query ${E}`,content:"",isDirty:!1};j([c,b].filter(_=>_!==void 0)),v(b.id),k(_=>_+1),a(""),B()},oe=c=>{const b=x.find(O=>O.id===c),_=x.find(O=>O.id==="docs");b&&(j((c==="docs"?[_]:[_,b]).filter(H=>H!==void 0)),v(c)),B()},le=c=>{const b=x.findIndex(H=>H.id===c),_=x.find(H=>H.id==="docs"),O=x.slice(0,b+1);_&&!O.includes(_)&&O.unshift(_),j(O),v(c),B()};return X.useEffect(()=>{const c=()=>{w.show&&B()};return document.addEventListener("click",c),()=>document.removeEventListener("click",c)},[w.show]),X.useEffect(()=>{const c=b=>{b.key==="Enter"&&(b.ctrlKey||b.metaKey)&&S!=="docs"&&!$&&(b.preventDefault(),q())};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[S,$,q]),e.jsxs("div",{className:`bg-light border-start d-flex flex-column h-100 ${g}`,style:{overflow:"hidden"},children:[e.jsx("div",{className:"border-bottom",style:{flexShrink:0,paddingTop:"calc(0.5rem - 3px)",borderBottomWidth:"1px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[n&&e.jsx("button",{className:"scroll-arrow scroll-arrow-left",onClick:Y,title:"Scroll left",children:e.jsx("i",{className:"bi bi-chevron-left"})}),e.jsxs("div",{className:"tab-scroll-container d-flex flex-grow-1",style:{overflow:"hidden"},children:[x.map(c=>e.jsxs("div",{className:`tab-item ${S===c.id?"active":""}`,onClick:()=>U(c.id),onContextMenu:b=>ae(b,c.id),children:[$===c.id?e.jsx("input",{type:"text",value:D,onChange:b=>u(b.target.value),onBlur:R,onKeyDown:se,className:"tab-edit-input",autoFocus:!0,onClick:b=>b.stopPropagation()}):e.jsx(e.Fragment,{children:e.jsx("span",{className:"tab-name",onDoubleClick:b=>{b.stopPropagation(),J(c.id)},children:c.name})}),c.id!=="docs"&&e.jsx("button",{className:"tab-close",onClick:b=>{b.stopPropagation(),W(c.id)},children:e.jsx("i",{className:"bi bi-x"})})]},c.id)),e.jsx("div",{className:"tab-item new-tab-tab",onClick:z,title:"New Query",children:e.jsx("i",{className:"bi bi-plus"})})]}),p&&e.jsx("button",{className:"scroll-arrow scroll-arrow-right",onClick:Q,title:"Scroll right",children:e.jsx("i",{className:"bi bi-chevron-right"})})]})}),e.jsx("div",{className:"flex-grow-1 d-flex flex-column",style:{minHeight:0,position:"relative",overflow:"hidden"},children:S==="docs"?e.jsx("div",{className:"flex-grow-1",style:{overflow:"auto",maxHeight:"100%"},children:h?e.jsx(Ge,{schemaName:h,models:d,className:"h-100"}):e.jsx(We,{selectedTable:i,selectedColumn:f,className:"h-100"})}):e.jsx("div",{className:"p-3 d-flex flex-column flex-grow-1",children:e.jsx("textarea",{className:"form-control font-monospace flex-grow-1 query-editor-textarea",value:F?.content||"",onChange:c=>L(c.target.value),placeholder:"Enter your SQL query here or use the AI Assistant to generate it for you.",style:{resize:"none",overflow:"auto",scrollbarWidth:"thin"}})})}),e.jsx("div",{className:"p-3 border-top",style:{flexShrink:0},children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white"},onClick:q,children:[e.jsx("i",{className:"bi bi-play me-1"}),"Execute"]}),e.jsxs("button",{className:"btn btn-outline-secondary",onClick:r,children:[e.jsx("i",{className:"bi bi-save me-1"}),"Save"]}),e.jsxs("button",{className:"btn btn-outline-secondary",onClick:s,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Format"]})]})}),w.show&&e.jsxs("div",{className:"context-menu",style:{position:"fixed",top:w.y,left:w.x,zIndex:1e3},onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"context-menu-item",onClick:()=>re(w.tabId),children:[e.jsx("i",{className:"bi bi-files me-2"}),"Duplicate Tab"]}),e.jsxs("div",{className:"context-menu-item",onClick:ne,children:[e.jsx("i",{className:"bi bi-x-square me-2"}),"Close All"]}),e.jsxs("div",{className:"context-menu-item",onClick:()=>oe(w.tabId),children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Close Others"]}),e.jsxs("div",{className:"context-menu-item",onClick:()=>le(w.tabId),children:[e.jsx("i",{className:"bi bi-arrow-right-square me-2"}),"Close Others to the Right"]})]})]})},He=t.memo(Ue),Be=({results:o,columns:a,isExecuting:l,error:r,selectedRowIndex:s,onRowSelect:i})=>{const f=t.useRef(null);return t.useEffect(()=>{const h=g=>{if(o.length!==0){if(g.key==="ArrowDown"){g.preventDefault();const x=s===null?0:Math.min(s+1,o.length-1);i(x)}else if(g.key==="ArrowUp"){g.preventDefault();const x=s===null?0:Math.max(s-1,0);i(x)}}},d=f.current;if(d)return d.addEventListener("keydown",h),()=>d.removeEventListener("keydown",h)},[o.length,s,i]),t.useEffect(()=>{o.length>0&&s===null&&i(0)},[o.length,s,i]),e.jsxs("div",{ref:f,className:"p-2 flex-grow-1 d-flex flex-column",style:{height:"100%",overflow:"hidden"},tabIndex:0,onFocus:()=>{f.current&&f.current.focus()},children:[l&&e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-2 text-muted",children:"Executing query..."})]})}),r&&e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Query Error:"})," ",r]}),!l&&!r&&o.length>0&&e.jsx("div",{className:"flex-grow-1",style:{overflowY:"auto",overflowX:"auto",height:"100%",scrollbarWidth:"thin"},children:e.jsxs("table",{className:"table table-striped table-hover table-sm",style:{whiteSpace:"nowrap",fontSize:"0.875rem"},children:[e.jsx("thead",{className:"sticky-top",children:e.jsx("tr",{children:a.map((h,d)=>e.jsx("th",{style:{whiteSpace:"nowrap",padding:"0.5rem 0.6rem 0.4rem 0.6rem",lineHeight:"1.2",color:"white",backgroundColor:"#495057",border:"none"},children:h},d))})}),e.jsx("tbody",{children:o.map((h,d)=>e.jsx("tr",{className:s===d?"table-row-selected":"",style:{lineHeight:"1.2",cursor:"pointer",transition:"background-color 0.2s ease",backgroundColor:s===d?"#e3f2fd":"transparent"},onClick:()=>i(d),onMouseEnter:g=>{s!==d&&(g.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:g=>{s!==d&&(g.currentTarget.style.backgroundColor="transparent")},children:a.map((g,x)=>e.jsx("td",{style:{whiteSpace:"nowrap",padding:"0.4rem 0.6rem",lineHeight:"1.2"},children:h[g]!==null&&h[g]!==void 0?String(h[g]):e.jsx("span",{className:"text-muted",children:"NULL"})},x))},d))})]})}),!l&&!r&&o.length===0&&e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsxs("div",{className:"text-center text-muted",children:[e.jsx("i",{className:"bi bi-table display-4 mb-3"}),e.jsx("div",{children:"No results to display"}),e.jsx("small",{children:"Execute a query to see results here"})]})})]})},Ke=t.memo(Be),qe={chart_type:{description:"line, bar, area, scatter, pie"}},Je={properties:qe},Re=({queryResults:o,columns:a,onConfigChange:l,className:r=""})=>{const[s,i]=t.useState({chart_type:"bar",x_key:"",y_key:"",series_key:"",series:[]}),[f,h]=t.useState([]),d=t.useMemo(()=>Je.properties.chart_type.description?.split(", ")||["line","bar","area","scatter","pie"],[]),g=t.useMemo(()=>!s.series_key||!o||o.length===0?[]:[...new Set(o.map(C=>C[s.series_key]).filter(C=>C!=null))].sort(),[s.series_key,o]),x=t.useMemo(()=>!s.series_key||f.length===0?o:o.filter(u=>f.includes(u[s.series_key])),[o,s.series_key,f]);t.useEffect(()=>{if(s.x_key&&s.y_key&&s.series_key&&x&&x.length>0){const C=[...new Set(x.map(y=>y[s.series_key]).filter(y=>y!=null))].map(y=>({type:s.chart_type,xKey:s.x_key,yKey:s.y_key,seriesValue:y}));i(y=>({...y,series:C,filteredData:x,selectedSeriesValues:f}))}else i(u=>({...u,series:[],filteredData:o,selectedSeriesValues:f}))},[s.x_key,s.y_key,s.series_key,s.chart_type,x,f,o]),t.useEffect(()=>{console.log("âš™ï¸ Chart Configuration (Formatted JSON):"),console.log(JSON.stringify(s,null,2)),l(s)},[s,l]);const j=u=>{i(C=>({...C,chart_type:u,series:C.series.map(y=>({...y,type:u}))}))},M=u=>{i(C=>({...C,x_key:u}))},S=u=>{i(C=>({...C,y_key:u}))},v=u=>{i(C=>({...C,series_key:u})),h([])},E=u=>{h(C=>C.includes(u)?C.filter(y=>y!==u):[...C,u])},k=()=>{h(g)},$=()=>{h([])},A=t.useMemo(()=>!o||o.length===0?a:a.filter(u=>{const C=o[0]?.[u];return typeof C=="number"||!isNaN(Number(C))}),[a,o]),D=t.useMemo(()=>!o||o.length===0?a:a.filter(u=>{const C=o[0]?.[u];return typeof C=="string"||typeof C=="object"}),[a,o]);return!o||o.length===0?e.jsxs("div",{className:`p-3 text-center text-muted ${r}`,children:[e.jsx("i",{className:"bi bi-bar-chart display-4 mb-3"}),e.jsx("div",{children:"No Data Available"}),e.jsx("small",{children:"Execute a query to configure charts"})]}):e.jsxs("div",{className:`px-3 py-2 ${r}`,style:{fontSize:"0.85rem"},children:[e.jsx("div",{className:"mb-2",children:e.jsx("h6",{className:"text-muted mb-2",style:{fontSize:"0.9rem"}})}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-bold",style:{color:"#aa0000",fontSize:"0.8rem"},children:"Chart Type"}),e.jsx("select",{className:"form-select",value:s.chart_type,onChange:u=>j(u.target.value),style:{borderColor:"#aa0000",fontSize:"0.8rem"},children:d.map(u=>e.jsx("option",{value:u,children:u.charAt(0).toUpperCase()+u.slice(1)},u))})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-bold",style:{color:"#aa0000",fontSize:"0.8rem"},children:"X-Axis (Category)"}),e.jsxs("select",{className:"form-select",value:s.x_key,onChange:u=>M(u.target.value),style:{borderColor:"#aa0000",fontSize:"0.8rem"},children:[e.jsx("option",{value:"",children:"Select X-axis column"}),D.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-bold",style:{color:"#aa0000",fontSize:"0.8rem"},children:"Y-Axis (Values)"}),e.jsxs("select",{className:"form-select",value:s.y_key,onChange:u=>S(u.target.value),style:{borderColor:"#aa0000",fontSize:"0.8rem"},children:[e.jsx("option",{value:"",children:"Select Y-axis column"}),A.map(u=>e.jsx("option",{value:u,children:u},u))]}),A.length===0&&e.jsx("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"},children:"No numeric columns found for Y-axis"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-bold",style:{color:"#aa0000",fontSize:"0.8rem"},children:"Series Differentiation"}),e.jsxs("select",{className:"form-select",value:s.series_key,onChange:u=>v(u.target.value),style:{borderColor:"#aa0000",fontSize:"0.8rem"},children:[e.jsx("option",{value:"",children:"Select series column"}),D.map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsx("div",{className:"text-muted small mt-1",style:{fontSize:"0.75rem"},children:"Column that groups data into different series"})]}),s.series_key&&g.length>0&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"border-top pt-3 mt-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label fw-bold mb-0",style:{color:"#aa0000",fontSize:"0.8rem"},children:"Filter Series"}),e.jsxs("div",{className:"btn-group btn-group-sm",role:"group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:k,children:"Select All"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:$,children:"Deselect All"})]})]}),e.jsx("div",{className:"d-flex flex-column gap-2",children:g.map((u,C)=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`series-${C}`,checked:f.includes(u),onChange:()=>E(u),style:{accentColor:"#aa0000"}}),e.jsx("label",{className:"form-check-label",htmlFor:`series-${C}`,children:String(u)})]},u))}),e.jsxs("div",{className:"text-muted small mt-2",style:{fontSize:"0.75rem"},children:["Showing ",f.length===0?g.length:f.length," of ",g.length," series"]})]})})]})]})},Ye=({metadata:o,queryResults:a=[],columns:l=[],chartConfig:r,onChartConfigChange:s})=>{const[i,f]=t.useState(!1),[h,d]=t.useState(!1),g=t.useRef(null),[x,j]=t.useState({width:0,height:0});t.useEffect(()=>{const S=()=>{if(g.current){const E=g.current.getBoundingClientRect();j({width:E.width,height:E.height})}};S();const v=new ResizeObserver(S);return g.current&&v.observe(g.current),()=>{v.disconnect()}},[i]);const M=t.useMemo(()=>{if(!r||!a||a.length===0)return null;const{chart_type:S,x_key:v,y_key:E,series_key:k,filteredData:$,selectedSeriesValues:A}=r,D=$&&$.length>0?$:a,u=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d3","#c7c7c7","#dbdb8d","#9edae5"];let C=[],y=[];if(k&&E){const m={};(D||[]).forEach(N=>{const w=N[k];w!=null&&(!A||A.length===0||A.includes(w))&&(m[w]||(m[w]=[]),m[w].push(N))}),y=Object.keys(m).map((N,w)=>({type:S,xKey:v,yKey:E,yName:N,data:m[N],connectMissingData:!1,style:{fill:u[w%u.length],stroke:u[w%u.length]},marker:{enabled:!1}})),C=D||[]}else C=D||[],y=[{type:S,xKey:v,yKey:E,data:C,connectMissingData:!1,style:{fill:u[0],stroke:u[0]},marker:{enabled:!1}}];console.log("ðŸ” Data Filtering Info:"),console.log(`- Using filtered data: ${$&&$.length>0?"Yes":"No"}`),console.log(`- Original query results: ${a.length} rows`),console.log(`- Filtered data: ${D.length} rows`),console.log(`- Selected series values: ${A?A.join(", "):"None"}`),console.log(`- Number of series: ${y.length}`),console.log("ðŸ“ˆ Series Configuration (Formatted JSON):"),console.log(JSON.stringify(y,null,2)),console.log("ðŸ“Š Chart Data (Formatted JSON):"),console.log(JSON.stringify(C,null,2));const n={data:C,series:y,title:{text:E&&v?`${E.toUpperCase()} by ${v.toUpperCase()}`:"Query Results Visualization",fontSize:16,color:"#aa0000"},background:{fill:"transparent"},axes:[{type:"category",position:"bottom",title:{text:v||"X-Axis"}},{type:"number",position:"left",title:{text:E||"Y-Axis"}}],legend:{enabled:y.length>1,item:{marker:{shape:"square",size:12}}},width:x.width>0?x.width:400,height:x.height>0?x.height:300};return console.log("ðŸ“ˆ Chart Options (Formatted JSON):"),console.log(JSON.stringify(n,null,2)),n},[r,a,x]);return e.jsx("div",{className:"flex-grow-1 d-flex position-relative",style:{height:"100%",overflow:"hidden"},children:a&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-grow-1 d-flex flex-column",style:{overflow:"hidden",minHeight:0},children:[M?e.jsx("div",{ref:g,className:"flex-grow-1",style:{width:"100%",height:"100%",position:"relative"},children:e.jsx("div",{style:{width:"100%",height:"100%"},children:e.jsx(_e,{options:M})})}):e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsxs("div",{className:"text-center text-muted",children:[e.jsx("i",{className:"bi bi-bar-chart display-4 mb-3"}),e.jsx("div",{children:"Configure Chart"}),e.jsx("small",{children:"Use the configuration panel to set up your visualization"})]})}),o&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>d(!h),style:{fontSize:"0.8rem"},children:[e.jsx("i",{className:`bi ${h?"bi-chevron-down":"bi-chevron-right"} me-1`}),"Raw Metadata"]}),h&&e.jsx("div",{className:"mt-2",style:{maxHeight:"200px",overflow:"auto"},children:e.jsx("pre",{className:"bg-light p-3 rounded",style:{fontSize:"0.75rem",lineHeight:"1.4",margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:JSON.stringify(o,null,2)})})]}),!i&&e.jsx("div",{className:"position-absolute",style:{top:"10px",right:"10px",zIndex:1e3},children:e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"white",borderColor:"#aa0000",color:"#aa0000",fontSize:"0.75rem",padding:"0.25rem 0.5rem"},onClick:()=>f(!0),title:"Open configuration panel",children:"Show Config"})})]}),e.jsxs("div",{className:`border-start bg-light d-flex flex-column ${i?"":"d-none"}`,style:{width:"350px",minWidth:"350px"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center px-3 py-2 border-bottom",children:[e.jsx("h6",{className:"mb-0 text-muted",style:{fontSize:"0.9rem"},children:"Chart Configuration"}),e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"white",borderColor:"#aa0000",color:"#aa0000",fontSize:"0.75rem"},onClick:()=>f(!i),title:i?"Collapse configuration":"Expand configuration",children:"Hide Config"})]}),e.jsx("div",{className:"flex-grow-1",style:{overflow:"auto"},children:e.jsx(Re,{queryResults:a,columns:l,onConfigChange:s})})]})]}):e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsxs("div",{className:"text-center text-muted",children:[e.jsx("i",{className:"bi bi-graph-up display-4 mb-3"}),e.jsx("div",{children:"No Analysis Available"}),e.jsx("small",{children:"Execute a query to see execution metadata and configure charts"})]})})})},Qe=t.memo(Ye),Ve=({results:o,columns:a,onRowSelect:l,selectedRowIndex:r})=>{const s=t.useRef(null),i=t.useRef(null),[f,h]=t.useState(!1),[d,g]=t.useState(null),[x,j]=t.useState(null),M=t.useRef("");t.useEffect(()=>s.current?((async()=>{try{const n=document.createElement("link");n.rel="stylesheet",n.href="https://js.arcgis.com/4.29/esri/themes/light/main.css",document.head.appendChild(n);const m=new Ae({basemap:"gray-vector"}),p=new Le({container:s.current,map:m,center:[-98.5795,39.8283],zoom:4});i.current=p,await p.when(),h(!0),p.on("click",w=>{p.hitTest(w).then(T=>{if(T.results.length>0){const F=T.results[0].graphic;if(F&&F.attributes&&F.attributes.id!==void 0){const z=F.attributes.id;j(z),l&&l(z)}}})});const N=new De;m.add(N),o&&o.length>0&&E(o,a,N,!0)}catch(n){console.error("Error initializing map:",n),g("Failed to initialize map")}})(),()=>{i.current&&(i.current.destroy(),i.current=null)}):void 0,[]);const S=(y,n)=>{const m=JSON.stringify({results:y,columns:n});return btoa(m).slice(0,16)};t.useEffect(()=>{if(f&&o&&o.length>0&&i.current){const y=i.current.map.layers.find(n=>n.type==="graphics");if(y){const n=S(o,a||[]),m=n!==M.current;console.log("MapTab: Processing spatial data",{isNewDataset:m,currentHash:M.current,newHash:n}),y.removeAll(),E(o,a||[],y,m),m&&(M.current=n)}}},[o,a,f]),t.useEffect(()=>{if(f&&i.current){const y=i.current.map.layers.find(n=>n.type==="graphics");y&&v(y,x)}},[x,f]),t.useEffect(()=>{const y=m=>{if(!(!o||o.length===0||!l)){if(m.key==="ArrowDown"){m.preventDefault();const N=Math.min((r??-1)+1,o.length-1);l(N)}else if(m.key==="ArrowUp"){m.preventDefault();const N=Math.max((r??0)-1,0);l(N)}}},n=s.current;if(n)return n.addEventListener("keydown",y),()=>n.removeEventListener("keydown",y)},[o,r,l]),t.useEffect(()=>{r!=null&&r!==x&&j(r)},[r,x]);const v=(y,n)=>{y&&y.graphics.forEach(m=>{const p=m.attributes.id===n;m.geometry.type==="point"?m.symbol=new ce({color:p?"white":"#aa0000",size:p?12:8,outline:p?{color:"#aa0000",width:2}:{color:"#aa0000",width:2},style:"circle"}):m.geometry.type==="polyline"?m.symbol=new de({color:p?"#ff0000":"#aa0000",width:p?5:3}):m.geometry.type==="polygon"&&(m.symbol=new he({color:p?[255,0,0,.5]:[170,0,0,.3],outline:{color:p?"#ff0000":"#aa0000",width:p?3:2}}))})},E=(y,n=[],m,p=!0)=>{if(!y||y.length===0)return;const N=n.filter(w=>y.some(T=>T[w]&&typeof T[w]=="string"&&(T[w].includes("POINT")||T[w].includes("LINESTRING")||T[w].includes("POLYGON")||T[w].startsWith("point:")||T[w].startsWith("linestring:")||T[w].startsWith("polygon:"))));if(N.length===0){console.log("No spatial data found in results");return}y.forEach((w,T)=>{N.forEach(F=>{const z=w[F];if(z)try{let W,U;if(z.startsWith("point:")){const L=$(z);L&&(W=new xe({longitude:L.longitude,latitude:L.latitude,spatialReference:{wkid:L.crs}}),U=new ce({color:"white",size:8,outline:{color:"#aa0000",width:2},style:"circle"}))}else if(z.startsWith("linestring:")){const L=A(z);L&&(W=new ge({paths:[L.coordinates],spatialReference:{wkid:L.crs}}),U=new de({color:"#aa0000",width:3}))}else if(z.startsWith("polygon:")){const L=D(z);L&&(W=new pe({rings:L.rings,spatialReference:{wkid:L.crs}}),U=new he({color:[170,0,0,.3],outline:{color:"#aa0000",width:2}}))}else if(z.includes("POINT")){const L=k(z);L&&(W=new xe({longitude:L[0],latitude:L[1],spatialReference:{wkid:4326}}),U=new ce({color:"white",size:8,outline:{color:"#aa0000",width:2},style:"circle"}))}else if(z.includes("LINESTRING")){const L=u(z);L&&(W=new ge({paths:[L],spatialReference:{wkid:4326}}),U=new de({color:"#aa0000",width:3}))}else if(z.includes("POLYGON")){const L=C(z);L&&(W=new pe({rings:L,spatialReference:{wkid:4326}}),U=new he({color:[170,0,0,.3],outline:{color:"#aa0000",width:2}}))}if(W&&U){const L=new Me({geometry:W,symbol:U,attributes:{id:T,...w}});m.add(L)}}catch(W){console.warn(`Error processing spatial data for row ${T}:`,W)}})}),console.log("MapTab: processSpatialData",{shouldZoom:p,graphicsCount:m.graphics.length}),p&&m.graphics.length>0&&(console.log("MapTab: Zooming to graphics"),i.current?.goTo(m.graphics))},k=y=>{const n=y.match(/POINT\s*\(\s*([-\d.]+)\s+([-\d.]+)\s*\)/i);return n?[parseFloat(n[1]),parseFloat(n[2])]:null},$=y=>{const n=y.match(/^point:\s*([-\d.]+),\s*([-\d.]+),\s*(\d+)$/i);return n?{longitude:parseFloat(n[1]),latitude:parseFloat(n[2]),crs:parseInt(n[3])}:null},A=y=>{const n=y.match(/^linestring:\s*([^,]+(?:,[^,]+)*),\s*(\d+)$/i);if(n){const m=n[1].split(",");if(m.length>=4&&m.length%2===0){const p=[];for(let N=0;N<m.length;N+=2)p.push([parseFloat(m[N]),parseFloat(m[N+1])]);return{coordinates:p,crs:parseInt(n[2])}}}return null},D=y=>{const n=y.match(/^polygon:\s*\(([^)]+)\),\s*(\d+)$/i);if(n){const m=n[1].split(",");if(m.length>=6&&m.length%2===0){const p=[];for(let N=0;N<m.length;N+=2)p.push([parseFloat(m[N]),parseFloat(m[N+1])]);return{rings:[p],crs:parseInt(n[2])}}}return null},u=y=>{const n=y.match(/LINESTRING\s*\((.*?)\)/i);return n?n[1].split(",").map(p=>{const[N,w]=p.trim().split(/\s+/);return[parseFloat(N),parseFloat(w)]}):null},C=y=>{const n=y.match(/POLYGON\s*\((.*?)\)/i);return n?n[1].split("),(").map(p=>p.replace(/[()]/g,"").split(",").map(w=>{const[T,F]=w.trim().split(/\s+/);return[parseFloat(T),parseFloat(F)]})):null};return e.jsx("div",{className:"flex-grow-1 d-flex flex-column",style:{height:"100%",overflow:"hidden"},children:d?e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-grow-1",children:e.jsxs("div",{className:"text-center text-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle display-4 mb-3"}),e.jsx("div",{children:"Map Error"}),e.jsx("small",{children:d})]})}):e.jsx("div",{ref:s,className:"flex-grow-1",style:{height:"100%",width:"100%"},tabIndex:0,onFocus:()=>{s.current&&s.current.focus()}})})},Xe=t.memo(Ve),Ze=({results:o,columns:a,rowCount:l,isExecuting:r,error:s,selectedRowIndex:i,onRowSelect:f,metadata:h,spatialColumns:d=[],className:g=""})=>{const[x,j]=t.useState("table"),[M,S]=t.useState(null),v=d.some(E=>a.includes(E));return t.useEffect(()=>{x==="map"&&!v&&j("table")},[x,v]),e.jsxs("div",{className:`flex-grow-1 d-flex flex-column results-panel ${g}`,style:{height:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"border-bottom",style:{flexShrink:0,paddingTop:"calc(0.5rem - 3px)",borderBottomWidth:"1px"},children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:`tab-item ${x==="table"?"active":""}`,onClick:()=>j("table"),children:e.jsxs("span",{className:"tab-name",children:[e.jsx("i",{className:"bi bi-table me-1"}),"Results",l>0&&e.jsxs("span",{className:"ms-1",children:["(",l,")"]})]})}),e.jsx("div",{className:`tab-item ${x==="analysis"?"active":""}`,onClick:()=>j("analysis"),children:e.jsxs("span",{className:"tab-name",children:[e.jsx("i",{className:"bi bi-graph-up me-1"}),"Chart"]})}),v&&e.jsx("div",{className:`tab-item ${x==="map"?"active":""}`,onClick:()=>j("map"),children:e.jsxs("span",{className:"tab-name",children:[e.jsx("i",{className:"bi bi-geo-alt me-1"}),"Map"]})})]})}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column",style:{height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{display:x==="table"?"flex":"none",height:"100%",flexDirection:"column"},children:e.jsx(Ke,{results:o,columns:a,rowCount:l,isExecuting:r,error:s,selectedRowIndex:i,onRowSelect:f})}),e.jsx("div",{style:{display:x==="analysis"?"flex":"none",height:"100%",flexDirection:"column"},children:e.jsx(Qe,{metadata:h,queryResults:o,columns:a,chartConfig:M,onChartConfigChange:S})}),v&&e.jsx("div",{style:{display:x==="map"?"flex":"none",height:"100%",flexDirection:"column"},children:e.jsx(Xe,{results:o,columns:a,onRowSelect:f,selectedRowIndex:i})})]})]})},es=t.memo(Ze),ss=({results:o,columns:a,isExecuting:l,error:r,selectedRow:s,isCollapsed:i,onToggle:f,className:h=""})=>i?e.jsxs("div",{className:`bg-light border-start d-flex flex-column h-100 ${h}`,style:{height:"100%"},children:[e.jsx("div",{className:"p-2 border-bottom flex-shrink-0 d-flex justify-content-center",children:e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white"},onClick:f,title:"Expand results details",children:e.jsx("i",{className:"bi bi-chevron-left"})})}),e.jsx("div",{className:"flex-grow-1 d-flex justify-content-center align-items-center",children:e.jsx("div",{style:{writingMode:"vertical-rl",textOrientation:"mixed",transform:"rotate(360deg)",fontSize:"1rem",fontWeight:"500",color:"#aa0000"},children:"Details"})})]}):e.jsxs("div",{className:`bg-light border-start d-flex flex-column h-100 ${h}`,style:{height:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"border-bottom flex-shrink-0",style:{padding:"calc(0.3125rem + 3px) 0.5rem"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Details"]}),e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white"},onClick:f,title:"Collapse details panel",children:e.jsx("i",{className:"bi bi-chevron-right"})})]})}),e.jsxs("div",{className:"flex-grow-1 p-3",style:{overflow:"auto"},children:[s&&e.jsx("div",{children:e.jsx("div",{className:"table-responsive",children:e.jsx("table",{className:"table table-sm table-striped",style:{fontSize:"0.875rem"},children:e.jsx("tbody",{children:a.map((d,g)=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-bold text-muted",style:{width:"40%",whiteSpace:"nowrap"},children:d}),e.jsx("td",{className:"text-truncate",style:{maxWidth:"200px"},title:s[d]!==null&&s[d]!==void 0?String(s[d]):"NULL",children:s[d]!==null&&s[d]!==void 0?String(s[d]):e.jsx("span",{className:"text-muted",children:"NULL"})})]},g))})})})}),!s&&o.length>0&&e.jsxs("div",{className:"text-center text-muted",children:[e.jsx("i",{className:"bi bi-info-circle display-4 mb-3"}),e.jsx("div",{children:"No row selected"}),e.jsx("small",{children:"Click on a row in the results table to view its details"})]}),o.length===0&&!l&&!r&&e.jsxs("div",{className:"text-center text-muted",children:[e.jsx("i",{className:"bi bi-table display-4 mb-3"}),e.jsx("div",{children:"No results to display"}),e.jsx("small",{children:"Execute a query to see results"})]})]})]}),ts=t.memo(ss),as=({className:o="",onSqlGenerated:a,isCollapsed:l=!1,onToggle:r})=>{const[s,i]=t.useState([]),[f,h]=t.useState(""),[d,g]=t.useState(!1),x=t.useRef(null),j=new ue;t.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[s]);const M=async()=>{if(f.trim()&&!d){const E={id:Date.now(),text:f,sender:"user"};i(k=>[...k,E]),h(""),g(!0);try{const k=await j.sendPrompt(f);if(k.success&&k.data)if(console.log("Response data:",k.data),console.log("Sql:",k.data.sql),console.log("onSqlGenerated prop:",a),k.data.sql){console.log("Calling onSqlGenerated with:",k.data.sql),a?a(k.data.sql):console.log("onSqlGenerated is not defined!");const $={id:Date.now()+1,text:"Your SQL is in the query editor.",sender:"ai"};i(A=>[...A,$])}else{const $=JSON.stringify(k.data,null,2),A={id:Date.now()+1,text:`**Data Service Response:**
\`\`\`json
${$}
\`\`\``,sender:"ai"};i(D=>[...D,A])}else{const $={id:Date.now()+1,text:`**Error:** ${k.error||"Failed to get response from data service"}`,sender:"ai"};i(A=>[...A,$])}}catch(k){const $={id:Date.now()+1,text:`**Error:** ${k instanceof Error?k.message:"Unknown error occurred"}`,sender:"ai"};i(A=>[...A,$])}finally{g(!1)}}},S=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),M())},v=()=>{i([])};return l?e.jsxs("div",{className:`bg-light border-start d-flex flex-column h-100 ${o}`,style:{height:"100%"},children:[e.jsx("div",{className:"p-2 border-bottom flex-shrink-0 d-flex justify-content-center",children:e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white"},onClick:r,title:"Expand chat panel",children:e.jsx("i",{className:"bi bi-chevron-left"})})}),e.jsx("div",{className:"flex-grow-1 d-flex justify-content-center align-items-center",children:e.jsx("div",{style:{writingMode:"vertical-rl",textOrientation:"mixed",transform:"rotate(360deg)",fontSize:"1rem",fontWeight:"500",color:"#aa0000"},children:"AI Assistant"})})]}):e.jsxs("div",{className:`bg-light border-start d-flex flex-column h-100 ${o}`,style:{height:"100%"},children:[e.jsx("div",{className:"p-2 border-bottom flex-shrink-0 panel-header",style:{background:"linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%)",borderBottomWidth:"2px"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"text-muted mb-0 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-chat-dots me-2"}),"AI Assistant"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white"},onClick:v,disabled:s.length===0,title:"Clear chat history",children:e.jsx("i",{className:"bi bi-trash"})}),e.jsx("button",{className:"btn btn-sm",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white"},onClick:r,title:"Collapse chat panel",children:e.jsx("i",{className:"bi bi-chevron-right"})})]})]})}),e.jsx("div",{ref:x,className:"flex-grow-1 p-3 overflow-auto chat-panel-scroll d-flex flex-column",children:e.jsxs("div",{className:"flex-grow-1",children:[s.map(E=>e.jsx("div",{className:`mb-3 ${E.sender==="user"?"text-end":"text-start"}`,children:e.jsx("div",{className:`d-inline-block p-2 rounded ${E.sender==="user"?"text-white":"bg-white border"}`,style:E.sender==="user"?{backgroundColor:"#aa0000"}:{},children:E.text})},E.id)),d&&e.jsx("div",{className:"mb-3 text-start",children:e.jsxs("div",{className:"d-inline-block p-2 rounded bg-white border",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm text-danger me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("span",{className:"text-muted",children:"Generating response..."})]}),e.jsx("div",{className:"progress mt-2",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar bg-danger",role:"progressbar",style:{width:"100%",animation:"progress-bar-stripes 1s linear infinite"}})})]})})]})}),e.jsx("div",{className:"p-3 border-top flex-shrink-0",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("textarea",{className:"form-control flex-grow-1",placeholder:d?"Almost there...":"redfive standing by...",value:f,onChange:E=>h(E.target.value),onKeyPress:S,disabled:d,rows:3,style:{resize:"vertical",minHeight:"75px"}}),e.jsx("button",{className:"btn align-self-start",style:{backgroundColor:"#aa0000",borderColor:"#aa0000",color:"white",marginTop:"2px"},onClick:M,disabled:d||!f.trim(),children:d?e.jsx("i",{className:"bi bi-hourglass-split"}):e.jsx("i",{className:"bi bi-send"})})]})})]})},me=({onResize:o,className:a=""})=>{const l=t.useRef(null),r=t.useRef(!1),s=t.useRef(0);return t.useEffect(()=>{const i=d=>{l.current?.contains(d.target)&&(r.current=!0,s.current=d.clientX,document.body.style.cursor="col-resize",document.body.style.userSelect="none",d.preventDefault())},f=d=>{if(r.current){const g=d.clientX-s.current;o(g),s.current=d.clientX}},h=()=>{r.current&&(r.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousedown",i),document.addEventListener("mousemove",f),document.addEventListener("mouseup",h),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",h)}},[o]),e.jsx("div",{ref:l,className:`resize-handle ${a}`,style:{width:"4px",backgroundColor:"#dee2e6",cursor:"col-resize",position:"relative",flexShrink:0},children:e.jsx("div",{style:{position:"absolute",top:0,left:"-2px",right:"-2px",bottom:0,backgroundColor:"transparent"}})})},rs=({onResize:o,className:a=""})=>{const l=t.useRef(null),r=t.useRef(!1),s=t.useRef(0);return t.useEffect(()=>{const i=d=>{l.current?.contains(d.target)&&(r.current=!0,s.current=d.clientY,document.body.style.cursor="row-resize",document.body.style.userSelect="none",d.preventDefault())},f=d=>{if(r.current){const g=d.clientY-s.current;o(g),s.current=d.clientY}},h=()=>{r.current&&(r.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousedown",i),document.addEventListener("mousemove",f),document.addEventListener("mouseup",h),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",h)}},[o]),e.jsx("div",{ref:l,className:`horizontal-resize-handle ${a}`,style:{height:"4px",backgroundColor:"#dee2e6",cursor:"row-resize",position:"relative",flexShrink:0,width:"100%"},children:e.jsx("div",{style:{position:"absolute",top:"-2px",left:0,right:0,bottom:"-2px",backgroundColor:"transparent"}})})};function ns(){const[o,a]=t.useState(""),[l,r]=t.useState([]),[s,i]=t.useState([]),[f,h]=t.useState(0),[d,g]=t.useState(!1),[x,j]=t.useState(null),M=t.useMemo(()=>new ue,[]),[S,v]=t.useState(312),[E,k]=t.useState(437),$=150,A=500,[D,u]=t.useState(50),C=20,y=80,[n,m]=t.useState(!1),[p,N]=t.useState(!0),[w,T]=t.useState(600),F=200,z=800,[W,U]=t.useState(null),[L,Z]=t.useState(null),[q,J]=t.useState(null),[R,ee]=t.useState(null),[se,Y]=t.useState(null),[Q,te]=t.useState([]),[ae,B]=t.useState([]),re=t.useCallback(async I=>{const G=I||o;g(!0),j(null);try{const P=await M.executeSql(G);P.success&&P.data?(r(P.data.data||[]),i(P.data.columns||[]),h(P.data.row_count||0),P.data.metadata&&Z(P.data.metadata)):(j(P.error||"Failed to execute query"),console.error("Query execution failed:",P.error))}catch(P){j(P instanceof Error?P.message:"Unknown error occurred"),console.error("Query execution error:",P)}finally{g(!1)}},[o,M]),ne=t.useCallback(()=>{},[o]),oe=t.useCallback(()=>{},[o]),le=t.useCallback(I=>{a(G=>G.trim()?`${G}

${I}`:I)},[]),c=t.useCallback(I=>{v(G=>{const P=G+I;return Math.max($,Math.min(A,P))})},[$,A]),b=t.useCallback(I=>{k(G=>{const P=G-I;return Math.max($,Math.min(A,P))})},[$,A]),_=t.useCallback(I=>{u(G=>{const P=I/window.innerHeight*100,V=G+P;return Math.max(C,Math.min(y,V))})},[C,y]),O=t.useCallback(()=>{m(I=>!I)},[]),H=t.useCallback(()=>{N(I=>!I)},[]),je=t.useCallback(I=>{T(G=>{const P=G-I;return Math.max(F,Math.min(z,P))})},[F,z]),ve=t.useCallback(I=>{J(I),Y(null)},[]),Ne=t.useCallback(I=>{Y(I),J(null)},[]),we=t.useCallback(I=>{const G=I.schema||"public",P=I.name,V=`SELECT * FROM ${G}.${P};`;a(fe=>fe.trim()?`${fe}

-- Generated SELECT for ${P}:
${V}`:V)},[]),ke=t.useCallback(I=>{B(I)},[]),Se=t.useMemo(()=>W!==null?l[W]:null,[W,l]),Ce=t.useMemo(()=>Q,[Q]);return e.jsx(Ie,{children:e.jsx(Pe,{children:e.jsxs("div",{className:"d-flex flex-column",style:{height:"100vh",margin:0,padding:0},children:[e.jsx(ze,{}),e.jsxs("div",{className:"flex-grow-1 d-flex",style:{height:"calc(100vh - 56px)",overflow:"hidden"},children:[e.jsx("div",{style:{width:`${S}px`,flexShrink:0,height:"100%"},children:e.jsx(Fe,{onTableSelect:ve,onColumnSelect:ee,onSchemaSelect:Ne,onModelsLoaded:te,onGenerateSelect:we,onSpatialColumnsLoaded:ke})}),e.jsx(me,{onResize:c}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column",style:{minWidth:0},children:[e.jsx("div",{style:{height:`${D}%`,flexShrink:0},children:e.jsx(He,{queryText:o,onQueryChange:a,onExecute:re,onSave:ne,onFormat:oe,selectedTable:q,selectedColumn:R||void 0,selectedSchema:se||void 0,models:Ce,className:"h-100"})}),e.jsx(rs,{onResize:_}),e.jsxs("div",{style:{height:`${100-D}%`,flexShrink:0},className:"d-flex",children:[e.jsx("div",{className:"flex-grow-1",style:{minWidth:0},children:e.jsx(es,{results:l,columns:s,rowCount:f,isExecuting:d,error:x,selectedRowIndex:W,onRowSelect:U,metadata:L,spatialColumns:ae})}),!p&&e.jsx(me,{onResize:je}),e.jsx("div",{style:{width:p?"40px":`${w}px`,flexShrink:0,transition:"width 0.3s ease"},children:e.jsx(ts,{results:l,columns:s,rowCount:f,isExecuting:d,error:x,selectedRow:Se,isCollapsed:p,onToggle:H})})]})]}),e.jsx(me,{onResize:b}),e.jsx("div",{style:{width:n?"40px":`${E}px`,flexShrink:0,transition:"width 0.3s ease"},children:e.jsx(as,{onSqlGenerated:le,isCollapsed:n,onToggle:O})})]})]})})})}$e.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(ns,{})}));
